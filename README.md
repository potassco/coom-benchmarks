# COOM Parser and Encoding

A parser to translate COOM DSL into ASP facts
plus a corresponding encoding.

## Installation
For the parser install ANTLR4 for python
```
pip install antlr4-tools
pip install antlr4-python3-runtime==4.9.3
```

The `model` directory contains is provided by denkbares and represents the current state of the COOM DSL language.
The specific version requirement stems from the fact that these files were created with ANTLR4 4.9.3.

More information on the ANTLR4 python target can be found here:
https://github.com/antlr/antlr4/blob/master/doc/python-target.md

## Usage
### Parser

To parse a `.coom` file you can run the auxiliary script
```
./parse.sh coom-files/kids-bike.coom
```
This will automatically save the file as an ASP instance in the `generated` folder.

The script makes use of the python script `parser/parse.py` which itself just prints the ASP facts to the console.

If you get exception `Exception: Could not deserialize ATN with version  (expected 4).' check that you have the correct antlr4-python-runtime version installed (currently 4.9.3).

### Testing
To test the parser run (the Python `unittest` package needs to be installed)
```
python -m unittest tests/tests_parser.py
```
TODO: Fix testing with new folder structure


### Solving
The files generated by the parser are located in the `generated` directory.
There are two encodings with different levels of features.
They are modular in the sense that the encoding for the travel bike
imports all rules from the kids bike encodings and builds on top of that.

The `encoding-kids.lp` contains all features of the kids bike.
To run
```
clingo encodings-kids.lp generated/kids-bike.lp
```

Similarly, for the travel bike run
```
clingo encoding-travel.lp generated/travel-bike.lp
```

> *Note:* The encodings are downward compatible, i.e., you can solve the kids bike
with the travel bike encoding as well.

## Documentation
For a documentation of the fact format see `FactFormat.md`.

## Design decisions and open topics

- How to handle SI units?
    - Should there be a conversion by the parser to some base unit? Simple to implement but maybe an advanced feature which we do not want in the paper
    - Or should all numerics be specified without SI units, thus in the same unit?
    - Or allow different units and user has to build in conversion into constraint, e.g., for travel bike?
- COOM allows nesting of conditions and requires. This is not supported by parser and encoding currently.
- COOM allows pointing to specific instances (e.g., first bag of carrier), although,
    this is not documented in the Quick Guide I found.
    Currently, the parser does not support this feature.
- Use of wildcards in tables is not supported
- forbid statement in tables is not supported
- Encoding assumes that there is one possible attribute at the end of a path / paths point only to one value
- Assumes that enumeration features have cardinality 1
- Assumes that constant and numbers appear only on the right hand side of a binary relation
